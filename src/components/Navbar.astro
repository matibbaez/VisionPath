---
// src/components/Navbar.astro
import Logo from './Logo.astro';

const navItems = [
  { name: "Inicio", label: "home", url: "#home" },
  { name: "Servicios", label: "services", url: "#servicios" },
  { name: "Proyectos", label: "projects", url: "#proyectos" },
  { name: "Soluciones", label: "projects", url: "#soluciones" },
];
---

<header class="fixed top-0 left-0 right-0 z-50 flex justify-center p-4 md:p-6 transition-all duration-300">
  
  <nav id="navbar" class="relative flex items-center justify-between px-6 py-3 rounded-full bg-surface/60 border border-white/5 shadow-2xl backdrop-blur-2xl w-full max-w-4xl transition-all duration-500 ease-out">
    
    <div class="z-10">
        <Logo />
    </div>

    <div class="hidden md:block">
        <ul class="relative flex items-center bg-black/20 rounded-full p-1 border border-white/5">
            
            <div 
                id="nav-indicator"
                class="absolute h-[calc(100%-8px)] top-1 rounded-full bg-white/10 shadow-[0_0_10px_rgba(255,255,255,0.1)] transition-all duration-500 cubic-bezier(0.23, 1, 0.32, 1) opacity-0 pointer-events-none"
            ></div>

            {navItems.map((item) => (
                <li class="relative z-10">
                    <a
                    href={item.url}
                    data-target={item.url.substring(1)} 
                    class="nav-link block px-6 py-2 text-sm font-medium text-gray-400 rounded-full transition-colors duration-300 hover:text-white"
                    >
                    {item.name}
                    </a>
                </li>
            ))}
        </ul>
    </div>

    <div class="flex items-center gap-4 z-10">
      
      <a href="#contacto" class="hidden md:inline-flex group relative items-center justify-center px-6 py-2 text-sm font-bold text-black bg-white rounded-full overflow-hidden transition-transform hover:scale-105 active:scale-95 shadow-[0_0_20px_-5px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_-5px_rgba(255,85,0,0.6)]">
        <div class="absolute inset-0 bg-gradient-to-r from-[--color-primary] to-orange-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 ease-out"></div>
        <span class="relative z-10 flex items-center gap-2 text-black group-hover:text-black transition-colors duration-300">
          Iniciar Proyecto
        </span>
      </a>

      <button id="menu-toggle" class="md:hidden relative group p-2 text-white focus:outline-none" aria-label="Menu">
          <div class="relative flex overflow-hidden items-center justify-center w-[24px] h-[24px]">
            <div class="flex flex-col justify-between w-[20px] h-[14px] transform transition-all duration-300 origin-center overflow-hidden">
                <div class="bg-white h-[2px] w-7 transform transition-all duration-300 origin-left group-[.expanded]:rotate-[42deg]"></div>
                <div class="bg-white h-[2px] w-1/2 rounded transform transition-all duration-300 group-[.expanded]:-translate-x-10"></div>
                <div class="bg-white h-[2px] w-7 transform transition-all duration-300 origin-left group-[.expanded]:-rotate-[42deg]"></div>
            </div>
          </div>
      </button>

    </div>
  </nav>

  <div 
    id="mobile-menu" 
    class="absolute top-24 left-4 right-4 p-6 bg-[#0A0A0A]/95 backdrop-blur-3xl border border-white/10 rounded-3xl transform scale-95 opacity-0 pointer-events-none transition-all duration-300 origin-top z-40 flex flex-col gap-4 text-center shadow-2xl"
  >
      {navItems.map((item) => (
        <a 
            href={item.url} 
            class="mobile-link text-xl font-medium text-gray-300 hover:text-[--color-primary] py-3 border-b border-white/5 last:border-0 transition-colors"
        >
            {item.name}
        </a>
      ))}
      
      <a href="#contacto" class="mobile-link mt-2 w-full py-4 bg-white text-black font-black rounded-xl shadow-[0_0_20px_rgba(255,255,255,0.2)] hover:bg-gray-200 transition-colors">
        Contactar Ahora
      </a>
  </div>

</header>

<script>
  // -- VARIABLES --
  const indicator = document.getElementById('nav-indicator');
  const navLinks = document.querySelectorAll('.nav-link');
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const navbar = document.getElementById('navbar');

  // -- LÓGICA ACTIVE GLIDE --
  function moveIndicator(element: HTMLElement) {
      if (!indicator || !element) return;
      const parentLi = element.closest('li');
      if (!parentLi) return;
      const width = parentLi.offsetWidth;
      const left = parentLi.offsetLeft;
      indicator.style.width = `${width}px`;
      indicator.style.transform = `translateX(${left}px)`;
      indicator.style.opacity = '1';
  }

  const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
          if (entry.isIntersecting) {
              const id = entry.target.getAttribute('id');
              if(!id) return;
              const activeLink = document.querySelector(`.nav-link[data-target="${id}"]`);
              if (activeLink instanceof HTMLElement) {
                  moveIndicator(activeLink);
                  navLinks.forEach(link => {
                      link.classList.remove('text-white', 'font-bold');
                      link.classList.add('text-gray-400');
                  });
                  activeLink.classList.add('text-white', 'font-bold');
                  activeLink.classList.remove('text-gray-400');
              }
          }
      });
  }, { rootMargin: '-50% 0px -50% 0px' });

  document.querySelectorAll('section[id]').forEach((section) => {
      observer.observe(section);
  });

  navLinks.forEach(link => {
      link.addEventListener('mouseenter', (e) => {
          const target = e.target as HTMLElement;
          moveIndicator(target);
      });
      link.addEventListener('click', (e) => {
           const target = e.currentTarget as HTMLElement;
           navLinks.forEach(l => l.classList.remove('text-white'));
           target.classList.add('text-white');
           moveIndicator(target);
      });
  });

  // -- LÓGICA MOBILE MENU --
  menuToggle?.addEventListener('click', () => {
    menuToggle.classList.toggle('expanded');
    const isExpanded = menuToggle.classList.contains('expanded');
    if (isExpanded) {
        mobileMenu?.classList.remove('scale-95', 'opacity-0', 'pointer-events-none');
        mobileMenu?.classList.add('scale-100', 'opacity-100', 'pointer-events-auto');
    } else {
        mobileMenu?.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
        mobileMenu?.classList.remove('scale-100', 'opacity-100', 'pointer-events-auto');
    }
  });

  // Cerrar menú al tocar cualquier link (incluido el botón de contacto)
  document.querySelectorAll('.mobile-link').forEach(link => {
      link.addEventListener('click', () => {
          menuToggle?.classList.remove('expanded');
          mobileMenu?.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
          mobileMenu?.classList.remove('scale-100', 'opacity-100', 'pointer-events-auto');
      });
  });

  // -- EFECTO SCROLL --
  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      navbar?.classList.add('py-2', 'px-8', 'bg-surface/80');
      navbar?.classList.remove('py-3', 'px-6', 'bg-surface/60');
    } else {
      navbar?.classList.remove('py-2', 'px-8', 'bg-surface/80');
      navbar?.classList.add('py-3', 'px-6', 'bg-surface/60');
    }
  });

  window.addEventListener('load', () => {
      if(window.scrollY < 100) {
          const home = document.querySelector('.nav-link[data-target="inicio"]');
          if(home instanceof HTMLElement) moveIndicator(home);
      }
  });
</script>