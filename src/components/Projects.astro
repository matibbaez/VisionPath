---
import { getLangFromUrl } from '../utils/i18n';
import { projectsData } from '../data/projects'; // <--- Importamos los datos

const lang = getLangFromUrl(Astro.url);

// Mapeamos los datos según el idioma
const projects = projectsData.map(p => ({
    ...p,
    title: p.title[lang],
    category: p.category[lang],
    description: p.description[lang],
    // Generamos el link dinámico
    link: `/${lang}/case/${p.id}` 
}));

const sectionLabel = lang === 'en' ? "CASE STUDIES" : "CASOS DE ÉXITO";
const title1 = lang === 'en' ? "Engineering that" : "Ingeniería que";
const title2 = lang === 'en' ? "transforms businesses." : "transforma negocios.";
const btnText = lang === 'en' ? "View Case" : "Ver Caso";
---

<section id="proyectos" class="relative py-24 md:py-32 bg-black">
    <div class="max-w-7xl mx-auto px-6">
        
        <div class="mb-16 md:mb-24">
            <span class="text-[--color-primary] font-mono text-sm tracking-widest uppercase mb-4 block">
                /// {sectionLabel}
            </span>
            <h2 class="text-4xl md:text-6xl font-bold text-white tracking-tight">
                {title1} <br/>
                <span class="text-glow-pop">{title2}</span>
            </h2>
        </div>

        <div class="flex flex-col gap-8 md:gap-12 pb-20">
            {projects.map((project) => (
                <article class="sticky top-24 md:top-32 min-h-[500px] w-full rounded-[2rem] bg-[#0A0A0A] border border-white/10 overflow-hidden shadow-2xl group flex flex-col md:grid md:grid-cols-2">
                    
                    <div class="relative z-20 p-6 md:p-12 flex flex-col justify-between order-2 md:order-1 h-full">
                        <div class={`absolute inset-0 bg-gradient-to-br ${project.color} opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none`}></div>

                        <div class="relative z-10">
                            <div class="flex items-center gap-3 mb-4 md:mb-6">
                                <span class="w-1.5 h-1.5 rounded-full bg-[--color-primary] animate-pulse"></span>
                                <span class="text-xs font-mono text-gray-500 tracking-wider uppercase group-hover:text-white/70 transition-colors">{project.category}</span>
                            </div>
                            
                            <h3 class="text-3xl md:text-5xl font-bold text-white leading-tight mb-4 tracking-tight">
                                {project.title}
                            </h3>
                            
                            <p class="text-gray-400 text-sm md:text-lg leading-relaxed max-w-md group-hover:text-gray-300 transition-colors">
                                {project.description}
                            </p>
                        </div>

                        <div class="relative z-10 mt-8 md:mt-0 pt-6 border-t border-white/5 md:border-0 flex flex-col items-start gap-6">
                            <div class="flex flex-wrap gap-2">
                                {project.tags.map(tag => (
                                    <span class="px-3 py-1 rounded-full border border-white/10 bg-white/5 text-xs font-medium text-gray-300 backdrop-blur-sm">
                                        {tag}
                                    </span>
                                ))}
                            </div>

                            <a href={project.link} class="group/btn inline-flex items-center gap-3 text-white text-sm font-bold tracking-wide uppercase border-b border-white/20 pb-1 hover:border-[--color-primary] hover:text-[--color-primary] transition-all">
                                {btnText}
                                <svg class="w-4 h-4 transition-transform group-hover/btn:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                            </a>
                        </div>
                    </div>
    
                    <div class="relative h-64 md:h-full w-full overflow-hidden order-1 md:order-2 border-b md:border-b-0 md:border-l border-white/5">
                        <div class="absolute inset-0 bg-black/40 group-hover:bg-transparent transition-colors duration-700 z-10"></div>
                        <img src={project.image} alt={project.title} class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-105 grayscale group-hover:grayscale-0" />
                    </div>
                </article>
            ))}
        </div>
    </div>
</section>